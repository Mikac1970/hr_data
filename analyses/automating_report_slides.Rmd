---
title: "Making PowerPoint Slides with R"
output: html_notebook
---
This is the first of what I hope will be a series of articles directed at what I referred to as the "third audience" in an article I published earlier this year - those who have a data background, but little HR expertise, and those in HR with a willingness to work with data, but not much of a background. There are already plenty of tutorials to show you how to run a regression or other predictive model, and I'm not sure that's what this audience will find most helpful. Please give me feedback on that. 

What I'm going to do is focus on showing you how to do things that don't require too much of a data background, but would be really helpful for the HR folks I know. Those with a stronger data background can use this as a starting point to add in more complex analyses, if they want.

## Making HR Reports
No matter how mature people analytics is at your organization, at some point you're going to need to make some reports. This is especially true if you're an HRBP with limited technical support - you might even be making these reports yourself! These reports, often done monthly, can take hours of VLOOKUPs and copy-pasting in Excel, then another while to put the right numbers into a PowerPoint template. Today I'm going to show you how to automate those reports using R, so you can save a bunch of time down the road.

## Getting Started with R
If you've never used R before, check out Richard Rosenow's Intro to R post (https://www.linkedin.com/pulse/hr-analytics-starter-kit-part-2-intro-r-richard-rosenow-pmp?trk=mp-reader-card), and specifically you can download R (https://mirror.las.iastate.edu/CRAN/) and RStudio (https://www.rstudio.com/products/rstudio/download3/). There are lots of helpful tips online about getting started with R - I'm writing this post with the assumption that you have RStudio installed and you're able to run code that I provide.

## Code for this article
The raw code for this article is found on my github repository at  (https://github.com/teuschb/hr_data/blob/master/analyses/automating_report_slides.Rmd).

## The ReporteRs package
What makes this possible is the `ReporteRs` package. To learn a lot more about what the package can do, check out http://davidgohel.github.io/ReporteRs/. It allows you to use R to run your analysis, print plots, and export everything to a PowerPoint document in a repeatable, automated way.

`ReporteRs` requires `rJava` and for java to be installed on your machine. This will make sure it's installed, and will show you the version of Java (it should be at least 1.6).
```{r}
require(rJava)
system("java -version")
```
The first time you use `ReporteRs`, you'll need to install the package from CRAN, the R package repository. 
```{r}
# Only run this the first time
#install.packages('ReporteRs')

#install.packages("extrafont")
#library(extrafont)
#font_import()
dput(gdtools::sys_fonts())

```


## Dataset

The dataset is the HR Employee Attrition and Performance dataset from IBM Watson Analytics (https://www.ibm.com/communities/analytics/watson-analytics-blog/hr-employee-attrition/). I've modified it slightly and saved it to my github repository, which allows me to read in the .csv file directly from the Internet, without needing to download a file.

In practice, this dataset will be your monthly HRIS report of headcount, attrition, performance, or anything else. That way, each month, you'll be able to run this same line of code, but simply insert the name of the most recent dataset that you want to work with. If all the columns are the same, the rest of the code will run without you having to make changes each month. 

```{r}
mydata <- read.csv("https://raw.githubusercontent.com/teuschb/hr_data/master/datasets/modified_watson_dataset.csv")

```

## Libraries
Before we can get started, we have to load in a few other packages I like to use. You'll see that `ReporteRs` is on the list - running `install.packages('ReporteRs')` gets the package onto our computer, and `library(ReporteRs)` tells R that we want to use that package right now. 

If you see a package name you don't recognize, make sure you run install.packages for it. For example, `install.packages('ggplot2')`.
```{r}
library(ReporteRs)
library(ggplot2)
library(scales)
```

## Set Report Parameters

```{r}
month = "November"
date = "November 2016"
```


## Analysis
What analysis needs to be done for the report? HR is often guilty of producing reports and dashboards on HR processes that don't directly help business leaders make better decisions. To keep things simple, I may be joining that trend. Since I don't have a specific business problem I'm trying to solve, and because HR is used to reporting on attrition, I'll prepare some data for a basic attrition report with a few bar charts to visualize the data. 

Just know that R is able to produce various types of charts and produce whatever analysis is necessary to help your business, given the correct data.

The first set of analysis is attrition by job role. First, I'm going to make a plot that shows the turnover by job role, and then I will build a small dataset that I will later put into a table to show the attrition by job role.
```{r}
mydata$AttritionFactor <- factor(mydata$Attrition, labels = c("No", "Yes"))
mydata$AttritionFactor <- factor(mydata$AttritionFactor, levels=rev(levels(mydata$AttritionFactor)))

ggplot(mydata, aes(JobRole)) +
  geom_bar(aes(fill = AttritionFactor), position = "fill") +
  scale_fill_manual(values = c("blue", "white"),guide=FALSE) +
  theme_bw() +
  guides(fill = F) +
  scale_y_continuous(labels=percent) +
  labs(list(y = paste("Attrition in ",month,sep = ""), x = "Job Role",
            title = paste("Attrition by Job Role, ", date, sep = ""))) +
  coord_flip()

```
Additional things could be sorting the bars, ...

Here I'm rearranging the raw data to get it into a format that goes well into a table later.

```{r}
attrition_by_jobrole <- cbind(data.frame(cbind(table(mydata$JobRole)),
                                         data.frame(cbind(table(mydata$JobRole, mydata$Attrition))[,2])))
names(attrition_by_jobrole) <- c("Headcount", "Attrition")
attrition_by_jobrole$AttritionPerc <- attrition_by_jobrole$Attrition/attrition_by_jobrole$Headcount
attrition_by_jobrole <- attrition_by_jobrole[order(attrition_by_jobrole$AttritionPerc, decreasing = TRUE),]
#FlexTable(attrition_by_jobrole)

```

Now I'm going to do the same thing for the other two attrition things I already decided on.

```{r}
ggplot(mydata, aes(PerformanceRating)) +
  geom_bar(aes(fill = AttritionFactor), position = "fill") +
  scale_fill_manual(values = c("blue", "white"),guide=FALSE) +
  theme_bw() +
  guides(fill = F) +
  scale_y_continuous(labels=percent) +
  labs(list(y = paste("Attrition in ",month,sep = ""), x = "Performance Rating",
            title = paste("Attrition by Performance Rating, ", date, sep = ""))) +
  coord_flip()

attrition_by_perf <- cbind(data.frame(cbind(table(mydata$PerformanceRating)),
                                         data.frame(cbind(table(mydata$PerformanceRating, mydata$Attrition))[,2])))
names(attrition_by_perf) <- c("Headcount", "Attrition")
attrition_by_perf$AttritionPerc <- attrition_by_perf$Attrition/attrition_by_perf$Headcount
attrition_by_perf <- attrition_by_perf[order(attrition_by_perf$AttritionPerc, decreasing = TRUE),]
```

```{r}
ggplot(mydata, aes(JobLevel)) +
  geom_bar(aes(fill = AttritionFactor), position = "fill") +
  scale_fill_manual(values = c("blue", "white"),guide=FALSE) +
  theme_bw() +
  guides(fill = F) +
  scale_y_continuous(labels=percent) +
  labs(list(y = paste("Attrition in ",month,sep = ""), x = "Job Level",
            title = paste("Attrition by Job Level, ", date, sep = ""))) +
  coord_flip()

attrition_by_joblevel <- cbind(data.frame(cbind(table(mydata$PerformanceRating)),
                                         data.frame(cbind(table(mydata$PerformanceRating, mydata$Attrition))[,2])))
names(attrition_by_joblevel) <- c("Headcount", "Attrition")
attrition_by_joblevel$AttritionPerc <- attrition_by_joblevel$Attrition/attrition_by_joblevel$Headcount
attrition_by_joblevel <- attrition_by_joblevel[order(attrition_by_joblevel$AttritionPerc, decreasing = TRUE),]

vanilla.table(attrition_by_joblevel)
```

What's great about using R to do the graphs is that next month, when the new data comes in, all I have to do is change the date, and the rest happens automatically. It takes a little more investment at first, but now all that dreaded Excel work will take almost no time at all! 

## Creating the Report

Once the charts and tables are finished, I need to put them into PowerPoint. I've done this by copy-pasting the graphs from R into the report, but it's tedious and allows room to make mistakes with where I place them, or what size they are.



Notes:
https://www.linkedin.com/pulse/manager-level-reporting-how-we-automate-process-andrew-marritt?trk=hp-feed-article-title-like

